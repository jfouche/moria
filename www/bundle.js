(()=>{"use strict";class e{constructor(e,t){this._x=e,this._y=t,this._life=100}get x(){return this._x}get y(){return this._y}get life(){return this._life}moveTo(e,t){this._x=e,this._y=t}move(e){let t=0,i=0;switch(e){case 0:i=-1;break;case 1:i=1;break;case 2:t=-1;break;case 3:t=1}this._x+=t,this._y+=i,this._life--}}class t{constructor(e,t){this.nRows=e,this.nCols=t,this.height=e*l.cellWidth+1,this.width=t*l.cellWidth+1,this.grid=[];for(var i=0;i<this.nRows;i++){this.grid[i]=[];for(var s=0;s<this.nCols;s++)this.grid[i][s]=new l(i,s)}this.upstair=r.upstair(0,0),this.downstair=r.downstairstair(e-1,t-1)}cell(e,t){return this.grid[e][t]}}class i{newMaze(e,i){let s=new t(e,i),l=[],r=s.cell(0,0);r.visited=!0;let o=!1;for(;!o;){let e=this.getNextNeighbor(s,r);e?(e.visited=!0,l.push(r),this.removeWallsBetween(r,e),r=e):l.length>0?(e=l.pop(),r=e):(console.log("FINISH"),o=!0)}for(var h=0;h<e;h++)for(var c=0;c<i;c++)s.cell(h,c).visited=!1;return this.removeRandomWalls(s,10),s}getNextNeighbor(e,t){let i,s=[];if(t.row>0){let i=e.cell(t.row-1,t.col);i.visited||s.push(i)}if(t.row<e.nRows-1){let i=e.cell(t.row+1,t.col);i.visited||s.push(i)}if(t.col>0){let i=e.cell(t.row,t.col-1);i.visited||s.push(i)}if(t.col<e.nCols-1){let i=e.cell(t.row,t.col+1);i.visited||s.push(i)}return s.length>0&&(i=s[o(0,s.length)]),i}removeWallsBetween(e,t){e.col>t.col?(e.borders.left=!1,t.borders.right=!1):e.col<t.col?(e.borders.right=!1,t.borders.left=!1):e.row>t.row?(e.borders.top=!1,t.borders.bottom=!1):e.row<t.row&&(e.borders.bottom=!1,t.borders.top=!1)}removeRandomWalls(e,t){for(let i=0;i<t;){let t=o(1,e.nRows-2),s=o(1,e.nCols-2),l=e.cell(t,s);switch(o(0,3)){case 0:l.borders.top&&(this.removeWallsBetween(l,e.cell(t-1,s)),console.log("remove (%d, %d) : top",s,t),i++);break;case 1:l.borders.right&&(this.removeWallsBetween(l,e.cell(t,s+1)),console.log("remove (%d, %d) : right",s,t),i++);break;case 2:l.borders.bottom&&(this.removeWallsBetween(l,e.cell(t+1,s)),console.log("remove (%d, %d) : bottom",s,t),i++);break;case 3:l.borders.left&&(this.removeWallsBetween(l,e.cell(t,s-1)),console.log("remove (%d, %d) : left",s,t),i++)}}}}class s{constructor(){this.top=!0,this.right=!0,this.bottom=!0,this.left=!0}}class l{constructor(e,t){this.visited=!1,this.row=e,this.col=t,this.borders=new s}}l.cellWidth=30;class r{constructor(e,t,i){this.row=e,this.col=t,this.up=i}static upstair(e,t){return new r(e,t,!0)}static downstairstair(e,t){return new r(e,t,!1)}}function o(e,t){return Math.floor(e+Math.random()*(t-e+1))}class h{constructor(t,s,l){this.nRows=t,this.nCols=s;let r=new i;this.mazes=[];for(let e=0;e<l;e++)this.mazes.push(r.newMaze(this.nRows,this.nCols));this.currentLevel=0;let o=this.maze();this.hero=new e(o.upstair.col,o.upstair.row),this.width=o.width,this.height=o.height,this.initLevel()}getLevel(){return this.currentLevel}initLevel(){let e=this.maze();this.hero.moveTo(e.upstair.col,e.upstair.row),e.cell(this.hero.y,this.hero.x).visited=!0,this.checkVisibility()}maze(){return this.mazes[this.currentLevel]}moveHero(e){this.canMove(e)&&(this.hero.move(e),this.maze().cell(this.hero.y,this.hero.x).visited=!0,this.hero.x===this.maze().downstair.col&&this.hero.y===this.maze().downstair.row&&(this.currentLevel++,this.initLevel()),this.checkVisibility())}canMove(e){let t=this.maze().cell(this.hero.y,this.hero.x).borders;return 3===e&&!t.right||2===e&&!t.left||0===e&&!t.top||1===e&&!t.bottom}checkVisibility(){let e,t,i,s=this.maze(),l=()=>{e=this.hero.x,t=this.hero.y,i=s.cell(t,e)},r=()=>{i=s.cell(t,e),i.visited=!0};for(l();!i.borders.top;)t-=1,r();for(l();!i.borders.right;)e+=1,r();for(l();!i.borders.bottom;)t+=1,r();for(l();!i.borders.left;)e-=1,r()}getHero(){return this.hero}}class c{constructor(e){this.maze=e}draw(e){for(let t=0;t<this.maze.nRows;t++)for(let i=0;i<this.maze.nCols;i++){let s=this.maze.cell(t,i);s.visited&&new n(s).draw(e)}this.maze.cell(this.maze.upstair.row,this.maze.upstair.col).visited&&new a(this.maze.upstair).draw(e),this.maze.cell(this.maze.downstair.row,this.maze.downstair.col).visited&&new a(this.maze.downstair).draw(e)}}class n{constructor(e){this.cell=e}draw(e){let t=l.cellWidth,i=this.cell.col*l.cellWidth,s=this.cell.row*l.cellWidth;e.noStroke(),e.fill(25,25,25),e.rect(i,s,t,t),e.stroke(255),e.noFill(),e.line(i,s,i,s+4),e.line(i+t,s,i+t,s+4),e.line(i+t,s,i+t-4,s),e.line(i+t,s+t,i+t-4,s+t),e.line(i+t,s+t,i+t,s+t-4),e.line(i,s+t,i,s+t-4),e.line(i,s+t,i+4,s+t),e.line(i,s,i+4,s),this.cell.borders.top&&e.line(i,s,i+t,s),this.cell.borders.right&&e.line(i+t,s,i+t,s+t),this.cell.borders.bottom&&e.line(i+t,s+t,i,s+t),this.cell.borders.left&&e.line(i,s+t,i,s)}highlight(e){e.noStroke(),e.fill(255,255,255,255);let t=l.cellWidth,i=this.cell.col*l.cellWidth,s=this.cell.row*l.cellWidth;e.ellipse(i+t/2,s+t/2,t/2,t/2)}}n.cellWidth=30;class a{constructor(e){this.stair=e}draw(e){e.stroke(255),this.stair.up?e.fill(192,192,192):e.fill(70,70,70);let t=l.cellWidth-6,i=this.stair.col*l.cellWidth+3,s=this.stair.row*l.cellWidth+3;e.rect(i,s,t,t)}}class d{constructor(e){this.game=e}draw(e){e.background(0),new c(this.game.maze()).draw(e);let t=this.game.getHero();new w(t).draw(e),document.getElementById("nLevel").innerHTML=this.game.getLevel().toString(),document.getElementById("life").innerHTML=t.life.toString()}}class w{constructor(e){this.hero=e}draw(e){e.stroke(255),this.hero.life>0?e.fill(0,255,0):e.fill(80,0,0);let t=this.hero.x*l.cellWidth+l.cellWidth/2,i=this.hero.y*l.cellWidth+l.cellWidth/2,s=l.cellWidth/2-1;e.ellipse(t,i,s,s)}}let m;new p5((function(e){e.setup=function(){m=new h(8,10,5),e.createCanvas(m.width,m.height).parent("game"),e.frameRate(10)},e.draw=function(){e.background(0),new d(m).draw(e),document.getElementById("nLevel").innerHTML=m.getLevel().toString()},e.keyPressed=function(){m.getHero().life<=0||(e.keyCode===e.UP_ARROW?m.moveHero(0):e.keyCode===e.DOWN_ARROW?m.moveHero(1):e.keyCode===e.LEFT_ARROW?m.moveHero(2):e.keyCode===e.RIGHT_ARROW&&m.moveHero(3))}}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9tb3JpYS8uL2FwcC9oZXJvLnRzIiwid2VicGFjazovL21vcmlhLy4vYXBwL21hemUudHMiLCJ3ZWJwYWNrOi8vbW9yaWEvLi9hcHAvZ2FtZS50cyIsIndlYnBhY2s6Ly9tb3JpYS8uL2FwcC92aWV3cy50cyIsIndlYnBhY2s6Ly9tb3JpYS8uL2FwcC9hcHAudHMiXSwibmFtZXMiOlsiSGVybyIsIngiLCJ5IiwidGhpcyIsIl94IiwiX3kiLCJfbGlmZSIsImRpciIsImR4IiwiZHkiLCJNYXplIiwiblJvd3MiLCJuQ29scyIsImhlaWdodCIsIkNlbGwiLCJjZWxsV2lkdGgiLCJ3aWR0aCIsImdyaWQiLCJyIiwiYyIsInVwc3RhaXIiLCJTdGFpciIsImRvd25zdGFpciIsImRvd25zdGFpcnN0YWlyIiwicm93IiwiY29sIiwiTWF6ZUdlbmVyYXRvciIsIm1hemUiLCJiYWNrdHJhY2tpbmciLCJjdXJyZW50Q2VsbCIsImNlbGwiLCJ2aXNpdGVkIiwiZmluaXNoZWQiLCJuZXh0IiwiZ2V0TmV4dE5laWdoYm9yIiwicHVzaCIsInJlbW92ZVdhbGxzQmV0d2VlbiIsImxlbmd0aCIsInBvcCIsImNvbnNvbGUiLCJsb2ciLCJyZW1vdmVSYW5kb21XYWxscyIsIm5laWdoYm9ycyIsImxlZnQiLCJyaWdodCIsInRvcCIsImJvdHRvbSIsInJhbmRvbSIsImEiLCJiIiwiYm9yZGVycyIsIm4iLCJpIiwiQ2VsbEJvcmRlcnMiLCJ1cCIsIm1pbiIsIm1heCIsIk1hdGgiLCJmbG9vciIsIk1vcmlhR2FtZSIsIm5MZXZlbHMiLCJtYXplR2VuZXJhdG9yIiwibWF6ZXMiLCJuZXdNYXplIiwiY3VycmVudExldmVsIiwiaGVybyIsImluaXRMZXZlbCIsIm1vdmVUbyIsImNoZWNrVmlzaWJpbGl0eSIsImRpcmVjdGlvbiIsImNhbk1vdmUiLCJtb3ZlIiwiY2VsbEJvcmRlcnMiLCJyZXNldCIsIk1hemVWaWV3IiwicCIsIkNlbGxWaWV3IiwiZHJhdyIsIlN0YWlyVmlldyIsInciLCJub1N0cm9rZSIsImZpbGwiLCJyZWN0Iiwic3Ryb2tlIiwibm9GaWxsIiwibGluZSIsImVsbGlwc2UiLCJzdGFpciIsIkdhbWVWaWV3IiwiZ2FtZSIsImJhY2tncm91bmQiLCJnZXRIZXJvIiwiSGVyb1ZpZXciLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwiZ2V0TGV2ZWwiLCJ0b1N0cmluZyIsImxpZmUiLCJwNSIsInNldHVwIiwiY3JlYXRlQ2FudmFzIiwicGFyZW50IiwiZnJhbWVSYXRlIiwia2V5UHJlc3NlZCIsImtleUNvZGUiLCJVUF9BUlJPVyIsIm1vdmVIZXJvIiwiRE9XTl9BUlJPVyIsIkxFRlRfQVJST1ciLCJSSUdIVF9BUlJPVyJdLCJtYXBwaW5ncyI6Im1CQU9PLE1BQU1BLEVBS1QsWUFBWUMsRUFBV0MsR0FDbkJDLEtBQUtDLEdBQUtILEVBQ1ZFLEtBQUtFLEdBQUtILEVBQ1ZDLEtBQUtHLE1BQVEsSUFHakIsUUFDSSxPQUFPSCxLQUFLQyxHQUdoQixRQUNJLE9BQU9ELEtBQUtFLEdBR2hCLFdBQ0ksT0FBT0YsS0FBS0csTUFHVCxPQUFPTCxFQUFXQyxHQUNyQkMsS0FBS0MsR0FBS0gsRUFDVkUsS0FBS0UsR0FBS0gsRUFHUCxLQUFLSyxHQUNSLElBQUlDLEVBQUssRUFBR0MsRUFBSyxFQUNqQixPQUFRRixHQUNKLEtBQUssRUFBY0UsR0FBTSxFQUFHLE1BQzVCLEtBQUssRUFBZ0JBLEVBQUssRUFBRyxNQUM3QixLQUFLLEVBQWdCRCxHQUFNLEVBQUcsTUFDOUIsS0FBSyxFQUFpQkEsRUFBSyxFQUcvQkwsS0FBS0MsSUFBTUksRUFDWEwsS0FBS0UsSUFBTUksRUFDWE4sS0FBS0csU0MzQ04sTUFBTUksRUFTVCxZQUFZQyxFQUFlQyxHQUN2QlQsS0FBS1EsTUFBUUEsRUFDYlIsS0FBS1MsTUFBUUEsRUFDYlQsS0FBS1UsT0FBU0YsRUFBUUcsRUFBS0MsVUFBWSxFQUN2Q1osS0FBS2EsTUFBUUosRUFBUUUsRUFBS0MsVUFBWSxFQUN0Q1osS0FB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QzdCNEQsRUFBRVcsUUFBUXJGLEVBQUdDLEVBQUdnQixFQUFHQSxJQ3pKM0IsSUFBSXVFLEVBc0NPLElBQUlVLElBL0JGLFNBQVV4QixHQUNuQkEsRUFBRXlCLE1BQVEsV0FDTlgsRUFBTyxJQUFJOUIsRUFBVSxFQUFHLEdBQUksR0FDZmdCLEVBQUUwQixhQUFhWixFQUFLekUsTUFBT3lFLEVBQUs1RSxRQUN0Q3lGLE9BQU8sUUFDZDNCLEVBQUU0QixVQUFVLEtBR2hCNUIsRUFBRUUsS0FBTyxXQUNMRixFQUFFZSxXQUFXLEdBQ0YsSUFBSUYsRUFBU0MsR0FDbkJaLEtBQUtGLEdBZkNrQixTQUFTQyxlQUFlLFVBQzlCQyxVQUFZTixFQUFLTyxXQUFXQyxZQWtCckN0QixFQUFFNkIsV0FBYSxXQUNQZixFQUFLRSxVQUFVTyxNQUFRLElBR3ZCdkIsRUFBRThCLFVBQVk5QixFQUFFK0IsU0FDaEJqQixFQUFLa0IsU0FBUyxHQUNQaEMsRUFBRThCLFVBQVk5QixFQUFFaUMsV0FDdkJuQixFQUFLa0IsU0FBUyxHQUNQaEMsRUFBRThCLFVBQVk5QixFQUFFa0MsV0FDdkJwQixFQUFLa0IsU0FBUyxHQUNQaEMsRUFBRThCLFVBQVk5QixFQUFFbUMsYUFDdkJyQixFQUFLa0IsU0FBUyxTIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBlbnVtIERpcmVjdGlvbiB7XHJcbiAgICBVUCwgRE9XTiwgTEVGVCwgUklHSFRcclxufVxyXG5cclxuLyoqXHJcbiAqIEhlcm9cclxuICovXHJcbmV4cG9ydCBjbGFzcyBIZXJvIHtcclxuICAgIHByaXZhdGUgX3g6IG51bWJlcjtcclxuICAgIHByaXZhdGUgX3k6IG51bWJlcjtcclxuICAgIHByaXZhdGUgX2xpZmU6IG51bWJlcjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcih4OiBudW1iZXIsIHk6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuX3ggPSB4O1xyXG4gICAgICAgIHRoaXMuX3kgPSB5O1xyXG4gICAgICAgIHRoaXMuX2xpZmUgPSAxMDA7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCB4KCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3g7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCB5KCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3k7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBsaWZlKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9saWZlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBtb3ZlVG8oeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcclxuICAgICAgICB0aGlzLl94ID0geDtcclxuICAgICAgICB0aGlzLl95ID0geTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbW92ZShkaXI6IERpcmVjdGlvbikge1xyXG4gICAgICAgIGxldCBkeCA9IDAsIGR5ID0gMDtcclxuICAgICAgICBzd2l0Y2ggKGRpcikge1xyXG4gICAgICAgICAgICBjYXNlIERpcmVjdGlvbi5VUDogZHkgPSAtMTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgRGlyZWN0aW9uLkRPV046IGR5ID0gMTsgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgRGlyZWN0aW9uLkxFRlQ6IGR4ID0gLTE7IGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIERpcmVjdGlvbi5SSUdIVDogZHggPSAxOyBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDogYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3ggKz0gZHg7XHJcbiAgICAgICAgdGhpcy5feSArPSBkeTtcclxuICAgICAgICB0aGlzLl9saWZlLS07XHJcbiAgICB9XHJcbn1cclxuIiwiLyoqXHJcbiAqIEBjbGFzcyBNYXplXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgTWF6ZSB7XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgblJvd3M6IG51bWJlcjtcclxuICAgIHB1YmxpYyByZWFkb25seSBuQ29sczogbnVtYmVyO1xyXG4gICAgcHVibGljIHJlYWRvbmx5IHdpZHRoOiBudW1iZXI7XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgaGVpZ2h0OiBudW1iZXI7XHJcbiAgICBwcml2YXRlIGdyaWQ6IENlbGxbXVtdO1xyXG4gICAgcHVibGljIHJlYWRvbmx5IHVwc3RhaXI6IFN0YWlyO1xyXG4gICAgcHVibGljIHJlYWRvbmx5IGRvd25zdGFpcjogU3RhaXI7XHJcblxyXG4gICAgY29uc3RydWN0b3IoblJvd3M6IG51bWJlciwgbkNvbHM6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMublJvd3MgPSBuUm93cztcclxuICAgICAgICB0aGlzLm5Db2xzID0gbkNvbHM7XHJcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBuUm93cyAqIENlbGwuY2VsbFdpZHRoICsgMTtcclxuICAgICAgICB0aGlzLndpZHRoID0gbkNvbHMgKiBDZWxsLmNlbGxXaWR0aCArIDE7XHJcbiAgICAgICAgdGhpcy5ncmlkID0gW107XHJcblxyXG4gICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgdGhpcy5uUm93czsgcisrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JpZFtyXSA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IHRoaXMubkNvbHM7IGMrKykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ncmlkW3JdW2NdID0gbmV3IENlbGwociwgYyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cHN0YWlyID0gU3RhaXIudXBzdGFpcigwLCAwKTtcclxuICAgICAgICB0aGlzLmRvd25zdGFpciA9IFN0YWlyLmRvd25zdGFpcnN0YWlyKG5Sb3dzIC0gMSwgbkNvbHMgLSAxKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2VsbChyb3c6IG51bWJlciwgY29sOiBudW1iZXIpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5ncmlkW3Jvd11bY29sXTtcclxuICAgIH1cclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBAY2xhc3MgTWF6ZUdlbmVyYXRvclxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIE1hemVHZW5lcmF0b3Ige1xyXG5cclxuICAgIHB1YmxpYyBuZXdNYXplKG5Sb3dzOiBudW1iZXIsIG5Db2xzOiBudW1iZXIpOiBNYXplIHtcclxuICAgICAgICBsZXQgbWF6ZSA9IG5ldyBNYXplKG5Sb3dzLCBuQ29scyk7XHJcbiAgICAgICAgbGV0IGJhY2t0cmFja2luZzogQ2VsbFtdID0gW107XHJcbiAgICAgICAgbGV0IGN1cnJlbnRDZWxsID0gbWF6ZS5jZWxsKDAsIDApO1xyXG4gICAgICAgIGN1cnJlbnRDZWxsLnZpc2l0ZWQgPSB0cnVlO1xyXG4gICAgICAgIGxldCBmaW5pc2hlZCA9IGZhbHNlO1xyXG4gICAgICAgIHdoaWxlICghZmluaXNoZWQpIHtcclxuICAgICAgICAgICAgbGV0IG5leHQgPSB0aGlzLmdldE5leHROZWlnaGJvcihtYXplLCBjdXJyZW50Q2VsbCk7XHJcbiAgICAgICAgICAgIGlmIChuZXh0KSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0LnZpc2l0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYmFja3RyYWNraW5nLnB1c2goY3VycmVudENlbGwpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVXYWxsc0JldHdlZW4oY3VycmVudENlbGwsIG5leHQpO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudENlbGwgPSBuZXh0O1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGJhY2t0cmFja2luZy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0ID0gYmFja3RyYWNraW5nLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudENlbGwgPSBuZXh0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJGSU5JU0hcIik7XHJcbiAgICAgICAgICAgICAgICBmaW5pc2hlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgblJvd3M7IHIrKykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IG5Db2xzOyBjKyspIHtcclxuICAgICAgICAgICAgICAgIG1hemUuY2VsbChyLCBjKS52aXNpdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucmVtb3ZlUmFuZG9tV2FsbHMobWF6ZSwgMTApO1xyXG5cclxuICAgICAgICByZXR1cm4gbWF6ZTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldE5leHROZWlnaGJvcihtYXplOiBNYXplLCBjZWxsOiBDZWxsKTogQ2VsbCB7XHJcbiAgICAgICAgbGV0IG5laWdoYm9yczogQ2VsbFtdID0gW107XHJcbiAgICAgICAgaWYgKGNlbGwucm93ID4gMCkge1xyXG4gICAgICAgICAgICBsZXQgbGVmdCA9IG1hemUuY2VsbChjZWxsLnJvdyAtIDEsIGNlbGwuY29sKTtcclxuICAgICAgICAgICAgaWYgKCFsZWZ0LnZpc2l0ZWQpIHtcclxuICAgICAgICAgICAgICAgIG5laWdoYm9ycy5wdXNoKGxlZnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjZWxsLnJvdyA8IG1hemUublJvd3MgLSAxKSB7XHJcbiAgICAgICAgICAgIGxldCByaWdodCA9IG1hemUuY2VsbChjZWxsLnJvdyArIDEsIGNlbGwuY29sKTtcclxuICAgICAgICAgICAgaWYgKCFyaWdodC52aXNpdGVkKSB7XHJcbiAgICAgICAgICAgICAgICBuZWlnaGJvcnMucHVzaChyaWdodCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNlbGwuY29sID4gMCkge1xyXG4gICAgICAgICAgICBsZXQgdG9wID0gbWF6ZS5jZWxsKGNlbGwucm93LCBjZWxsLmNvbCAtIDEpO1xyXG4gICAgICAgICAgICBpZiAoIXRvcC52aXNpdGVkKSB7XHJcbiAgICAgICAgICAgICAgICBuZWlnaGJvcnMucHVzaCh0b3ApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjZWxsLmNvbCA8IG1hemUubkNvbHMgLSAxKSB7XHJcbiAgICAgICAgICAgIGxldCBib3R0b20gPSBtYXplLmNlbGwoY2VsbC5yb3csIGNlbGwuY29sICsgMSk7XHJcbiAgICAgICAgICAgIGlmICghYm90dG9tLnZpc2l0ZWQpIHtcclxuICAgICAgICAgICAgICAgIG5laWdoYm9ycy5wdXNoKGJvdHRvbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBuZXh0OiBDZWxsID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmIChuZWlnaGJvcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB2YXIgciA9IHJhbmRvbSgwLCBuZWlnaGJvcnMubGVuZ3RoKTtcclxuICAgICAgICAgICAgbmV4dCA9IG5laWdoYm9yc1tyXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5leHQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZW1vdmVXYWxsc0JldHdlZW4oYTogQ2VsbCwgYjogQ2VsbCkge1xyXG4gICAgICAgIGlmIChhLmNvbCA+IGIuY29sKSB7XHJcbiAgICAgICAgICAgIGEuYm9yZGVycy5sZWZ0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGIuYm9yZGVycy5yaWdodCA9IGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoYS5jb2wgPCBiLmNvbCkge1xyXG4gICAgICAgICAgICBhLmJvcmRlcnMucmlnaHQgPSBmYWxzZTtcclxuICAgICAgICAgICAgYi5ib3JkZXJzLmxlZnQgPSBmYWxzZTtcclxuICAgICAgICB9IGVsc2UgaWYgKGEucm93ID4gYi5yb3cpIHtcclxuICAgICAgICAgICAgYS5ib3JkZXJzLnRvcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBiLmJvcmRlcnMuYm90dG9tID0gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIGlmIChhLnJvdyA8IGIucm93KSB7XHJcbiAgICAgICAgICAgIGEuYm9yZGVycy5ib3R0b20gPSBmYWxzZTtcclxuICAgICAgICAgICAgYi5ib3JkZXJzLnRvcCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlbW92ZVJhbmRvbVdhbGxzKG1hemU6IE1hemUsIG46IG51bWJlcikge1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjspIHtcclxuICAgICAgICAgICAgbGV0IHIgPSByYW5kb20oMSwgbWF6ZS5uUm93cyAtIDIpO1xyXG4gICAgICAgICAgICBsZXQgYyA9IHJhbmRvbSgxLCBtYXplLm5Db2xzIC0gMik7XHJcblxyXG4gICAgICAgICAgICBsZXQgY2VsbCA9IG1hemUuY2VsbChyLCBjKTtcclxuICAgICAgICAgICAgbGV0IG5leHQgPSByYW5kb20oMCwgMyk7XHJcbiAgICAgICAgICAgIHN3aXRjaCAobmV4dCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjZWxsLmJvcmRlcnMudG9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlV2FsbHNCZXR3ZWVuKGNlbGwsIG1hemUuY2VsbChyIC0gMSwgYykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInJlbW92ZSAoJWQsICVkKSA6IHRvcFwiLCBjLCByKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGwuYm9yZGVycy5yaWdodCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZVdhbGxzQmV0d2VlbihjZWxsLCBtYXplLmNlbGwociwgYyArIDEpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyZW1vdmUgKCVkLCAlZCkgOiByaWdodFwiLCBjLCByKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGwuYm9yZGVycy5ib3R0b20pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVXYWxsc0JldHdlZW4oY2VsbCwgbWF6ZS5jZWxsKHIgKyAxLCBjKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVtb3ZlICglZCwgJWQpIDogYm90dG9tXCIsIGMsIHIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2VsbC5ib3JkZXJzLmxlZnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVXYWxsc0JldHdlZW4oY2VsbCwgbWF6ZS5jZWxsKHIsIGMgLSAxKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVtb3ZlICglZCwgJWQpIDogbGVmdFwiLCBjLCByKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogQGNsYXNzIENlbGxCb3JkZXJzXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQ2VsbEJvcmRlcnMge1xyXG4gICAgdG9wOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIHJpZ2h0OiBib29sZWFuID0gdHJ1ZTtcclxuICAgIGJvdHRvbTogYm9vbGVhbiA9IHRydWU7XHJcbiAgICBsZWZ0OiBib29sZWFuID0gdHJ1ZTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEBjbGFzcyBDZWxsXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQ2VsbCB7XHJcbiAgICBwdWJsaWMgc3RhdGljIGNlbGxXaWR0aDogbnVtYmVyID0gMzA7XHJcblxyXG4gICAgcHVibGljIHJlYWRvbmx5IHJvdzogbnVtYmVyO1xyXG4gICAgcHVibGljIHJlYWRvbmx5IGNvbDogbnVtYmVyO1xyXG5cclxuICAgIHB1YmxpYyBib3JkZXJzOiBDZWxsQm9yZGVycztcclxuICAgIHB1YmxpYyB2aXNpdGVkOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gICAgY29uc3RydWN0b3Iocm93OiBudW1iZXIsIGNvbDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5yb3cgPSByb3c7XHJcbiAgICAgICAgdGhpcy5jb2wgPSBjb2w7XHJcbiAgICAgICAgdGhpcy5ib3JkZXJzID0gbmV3IENlbGxCb3JkZXJzKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTdGFpclxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFN0YWlyIHtcclxuICAgIHB1YmxpYyByZWFkb25seSByb3c6IG51bWJlcjtcclxuICAgIHB1YmxpYyByZWFkb25seSBjb2w6IG51bWJlcjtcclxuICAgIHB1YmxpYyByZWFkb25seSB1cDogYm9vbGVhbjtcclxuXHJcbiAgICBwcml2YXRlIGNvbnN0cnVjdG9yKHJvdzogbnVtYmVyLCBjb2w6IG51bWJlciwgdXA6IGJvb2xlYW4pIHtcclxuICAgICAgICB0aGlzLnJvdyA9IHJvdztcclxuICAgICAgICB0aGlzLmNvbCA9IGNvbDtcclxuICAgICAgICB0aGlzLnVwID0gdXA7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyB1cHN0YWlyKHJvdzogbnVtYmVyLCBjb2w6IG51bWJlcikge1xyXG4gICAgICAgIHJldHVybiBuZXcgU3RhaXIocm93LCBjb2wsIHRydWUpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGF0aWMgZG93bnN0YWlyc3RhaXIocm93OiBudW1iZXIsIGNvbDogbnVtYmVyKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBTdGFpcihyb3csIGNvbCwgZmFsc2UpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiByYW5kb20obWluOiBudW1iZXIsIG1heDogbnVtYmVyKSB7XHJcbiAgICByZXR1cm4gTWF0aC5mbG9vcihtaW4gKyBNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbiArIDEpKTtcclxufSIsImltcG9ydCB7IEhlcm8sIERpcmVjdGlvbiB9IGZyb20gXCIuL2hlcm9cIlxyXG5pbXBvcnQgeyBNYXplLCBNYXplR2VuZXJhdG9yLCBDZWxsIH0gZnJvbSBcIi4vbWF6ZVwiXHJcblxyXG4vKipcclxuICogTW9yaWFHYW1lXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgTW9yaWFHYW1lIHtcclxuICAgIHB1YmxpYyByZWFkb25seSBuUm93czogbnVtYmVyO1xyXG4gICAgcHVibGljIHJlYWRvbmx5IG5Db2xzOiBudW1iZXI7XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgd2lkdGg6IG51bWJlcjtcclxuICAgIHB1YmxpYyByZWFkb25seSBoZWlnaHQ6IG51bWJlcjtcclxuXHJcbiAgICBwcml2YXRlIGhlcm86IEhlcm87XHJcbiAgICBwcml2YXRlIG1hemVzOiBNYXplW107XHJcbiAgICBwcml2YXRlIGN1cnJlbnRMZXZlbDogbnVtYmVyO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKG5Sb3dzOiBudW1iZXIsIG5Db2xzOiBudW1iZXIsIG5MZXZlbHM6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMublJvd3MgPSBuUm93cztcclxuICAgICAgICB0aGlzLm5Db2xzID0gbkNvbHM7XHJcblxyXG4gICAgICAgIGxldCBtYXplR2VuZXJhdG9yID0gbmV3IE1hemVHZW5lcmF0b3IoKTtcclxuICAgICAgICB0aGlzLm1hemVzID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuTGV2ZWxzOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5tYXplcy5wdXNoKG1hemVHZW5lcmF0b3IubmV3TWF6ZSh0aGlzLm5Sb3dzLCB0aGlzLm5Db2xzKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbCA9IDA7XHJcblxyXG4gICAgICAgIGxldCBtYXplID0gdGhpcy5tYXplKCk7XHJcbiAgICAgICAgdGhpcy5oZXJvID0gbmV3IEhlcm8obWF6ZS51cHN0YWlyLmNvbCwgbWF6ZS51cHN0YWlyLnJvdyk7XHJcblxyXG4gICAgICAgIHRoaXMud2lkdGggPSBtYXplLndpZHRoO1xyXG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gbWF6ZS5oZWlnaHQ7XHJcblxyXG4gICAgICAgIHRoaXMuaW5pdExldmVsKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldExldmVsKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudExldmVsO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgaW5pdExldmVsKCkge1xyXG4gICAgICAgIGxldCBtYXplID0gdGhpcy5tYXplKCk7XHJcbiAgICAgICAgdGhpcy5oZXJvLm1vdmVUbyhtYXplLnVwc3RhaXIuY29sLCBtYXplLnVwc3RhaXIucm93KTtcclxuICAgICAgICBtYXplLmNlbGwodGhpcy5oZXJvLnksIHRoaXMuaGVyby54KS52aXNpdGVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmNoZWNrVmlzaWJpbGl0eSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBtYXplKCk6IE1hemUge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm1hemVzW3RoaXMuY3VycmVudExldmVsXTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgbW92ZUhlcm8oZGlyZWN0aW9uOiBEaXJlY3Rpb24pIHtcclxuICAgICAgICBpZiAodGhpcy5jYW5Nb3ZlKGRpcmVjdGlvbikpIHtcclxuICAgICAgICAgICAgdGhpcy5oZXJvLm1vdmUoZGlyZWN0aW9uKTtcclxuICAgICAgICAgICAgdGhpcy5tYXplKCkuY2VsbCh0aGlzLmhlcm8ueSwgdGhpcy5oZXJvLngpLnZpc2l0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5oZXJvLnggPT09IHRoaXMubWF6ZSgpLmRvd25zdGFpci5jb2wgJiYgdGhpcy5oZXJvLnkgPT09IHRoaXMubWF6ZSgpLmRvd25zdGFpci5yb3cpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudExldmVsKys7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRMZXZlbCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY2hlY2tWaXNpYmlsaXR5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjYW5Nb3ZlKGRpcmVjdGlvbjogRGlyZWN0aW9uKTogYm9vbGVhbiB7XHJcbiAgICAgICAgbGV0IGNlbGxCb3JkZXJzID0gdGhpcy5tYXplKCkuY2VsbCh0aGlzLmhlcm8ueSwgdGhpcy5oZXJvLngpLmJvcmRlcnM7XHJcbiAgICAgICAgcmV0dXJuIChkaXJlY3Rpb24gPT09IERpcmVjdGlvbi5SSUdIVCAmJiAhY2VsbEJvcmRlcnMucmlnaHQpXHJcbiAgICAgICAgICAgIHx8IChkaXJlY3Rpb24gPT09IERpcmVjdGlvbi5MRUZUICYmICFjZWxsQm9yZGVycy5sZWZ0KVxyXG4gICAgICAgICAgICB8fCAoZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uVVAgJiYgIWNlbGxCb3JkZXJzLnRvcClcclxuICAgICAgICAgICAgfHwgKGRpcmVjdGlvbiA9PT0gRGlyZWN0aW9uLkRPV04gJiYgIWNlbGxCb3JkZXJzLmJvdHRvbSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjaGVja1Zpc2liaWxpdHkoKSB7XHJcbiAgICAgICAgbGV0IHg6IG51bWJlcjtcclxuICAgICAgICBsZXQgeTogbnVtYmVyO1xyXG4gICAgICAgIGxldCBjZWxsOiBDZWxsO1xyXG4gICAgICAgIGxldCBtYXplID0gdGhpcy5tYXplKCk7XHJcbiAgICAgICAgbGV0IHJlc2V0ID0gKCkgPT4ge1xyXG4gICAgICAgICAgICB4ID0gdGhpcy5oZXJvLng7XHJcbiAgICAgICAgICAgIHkgPSB0aGlzLmhlcm8ueTtcclxuICAgICAgICAgICAgY2VsbCA9IG1hemUuY2VsbCh5LCB4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IG5leHQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNlbGwgPSBtYXplLmNlbGwoeSwgeCk7XHJcbiAgICAgICAgICAgIGNlbGwudmlzaXRlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc2V0KCk7XHJcbiAgICAgICAgd2hpbGUgKCFjZWxsLmJvcmRlcnMudG9wKSB7XHJcbiAgICAgICAgICAgIHkgLT0gMTtcclxuICAgICAgICAgICAgbmV4dCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXNldCgpO1xyXG4gICAgICAgIHdoaWxlICghY2VsbC5ib3JkZXJzLnJpZ2h0KSB7XHJcbiAgICAgICAgICAgIHggKz0gMTtcclxuICAgICAgICAgICAgbmV4dCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXNldCgpO1xyXG4gICAgICAgIHdoaWxlICghY2VsbC5ib3JkZXJzLmJvdHRvbSkge1xyXG4gICAgICAgICAgICB5ICs9IDE7XHJcbiAgICAgICAgICAgIG5leHQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzZXQoKTtcclxuICAgICAgICB3aGlsZSAoIWNlbGwuYm9yZGVycy5sZWZ0KSB7XHJcbiAgICAgICAgICAgIHggLT0gMTtcclxuICAgICAgICAgICAgbmV4dCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0SGVybygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5oZXJvO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgTWF6ZSwgQ2VsbCwgU3RhaXIgfSBmcm9tIFwiLi9tYXplXCJcclxuaW1wb3J0IHsgTW9yaWFHYW1lIH0gZnJvbSBcIi4vZ2FtZVwiXHJcbmltcG9ydCB7IEhlcm8gfSBmcm9tIFwiLi9oZXJvXCJcclxuXHJcbi8qKlxyXG4gKiBAY2xhc3MgTWF6ZVZpZXdcclxuICovXHJcbmV4cG9ydCBjbGFzcyBNYXplVmlldyB7XHJcbiAgICBwdWJsaWMgcmVhZG9ubHkgbWF6ZTogTWF6ZTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihtYXplOiBNYXplKSB7XHJcbiAgICAgICAgdGhpcy5tYXplID0gbWF6ZTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBkcmF3KHA6IHA1KSB7XHJcbiAgICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCB0aGlzLm1hemUublJvd3M7IHIrKykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IHRoaXMubWF6ZS5uQ29sczsgYysrKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY2VsbCA9IHRoaXMubWF6ZS5jZWxsKHIsIGMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNlbGwudmlzaXRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBjdiA9IG5ldyBDZWxsVmlldyhjZWxsKTtcclxuICAgICAgICAgICAgICAgICAgICBjdi5kcmF3KHApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5tYXplLmNlbGwodGhpcy5tYXplLnVwc3RhaXIucm93LCB0aGlzLm1hemUudXBzdGFpci5jb2wpLnZpc2l0ZWQpIHtcclxuICAgICAgICAgICAgbGV0IHN2ID0gbmV3IFN0YWlyVmlldyh0aGlzLm1hemUudXBzdGFpcik7XHJcbiAgICAgICAgICAgIHN2LmRyYXcocCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm1hemUuY2VsbCh0aGlzLm1hemUuZG93bnN0YWlyLnJvdywgdGhpcy5tYXplLmRvd25zdGFpci5jb2wpLnZpc2l0ZWQpIHtcclxuICAgICAgICAgICAgbGV0IHN2ID0gbmV3IFN0YWlyVmlldyh0aGlzLm1hemUuZG93bnN0YWlyKTtcclxuICAgICAgICAgICAgc3YuZHJhdyhwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAY2xhc3MgQ2VsbFZpZXdcclxuICovXHJcbmV4cG9ydCBjbGFzcyBDZWxsVmlldyB7XHJcbiAgICBwdWJsaWMgc3RhdGljIGNlbGxXaWR0aDogbnVtYmVyID0gMzA7XHJcblxyXG4gICAgcHVibGljIHJlYWRvbmx5IGNlbGw6IENlbGw7XHJcblxyXG4gICAgY29uc3RydWN0b3IoY2VsbDogQ2VsbCkge1xyXG4gICAgICAgIHRoaXMuY2VsbCA9IGNlbGw7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRyYXcocDogcDUpIHtcclxuICAgICAgICBsZXQgdyA9IENlbGwuY2VsbFdpZHRoO1xyXG4gICAgICAgIGxldCB4ID0gdGhpcy5jZWxsLmNvbCAqIENlbGwuY2VsbFdpZHRoO1xyXG4gICAgICAgIGxldCB5ID0gdGhpcy5jZWxsLnJvdyAqIENlbGwuY2VsbFdpZHRoO1xyXG4gICAgICAgIGNvbnN0IGIgPSA0O1xyXG5cclxuICAgICAgICBwLm5vU3Ryb2tlKCk7XHJcbiAgICAgICAgcC5maWxsKDI1LCAyNSwgMjUpO1xyXG5cclxuICAgICAgICBwLnJlY3QoeCwgeSwgdywgdylcclxuICAgICAgICBwLnN0cm9rZSgyNTUpO1xyXG4gICAgICAgIHAubm9GaWxsKCk7XHJcbiAgICAgICAgcC5saW5lKHgsIHksIHgsIHkgKyBiKTtcclxuICAgICAgICBwLmxpbmUoeCArIHcsIHksIHggKyB3LCB5ICsgYik7XHJcbiAgICAgICAgcC5saW5lKHggKyB3LCB5LCB4ICsgdyAtIGIsIHkpO1xyXG4gICAgICAgIHAubGluZSh4ICsgdywgeSArIHcsIHggKyB3IC0gYiwgeSArIHcpO1xyXG4gICAgICAgIHAubGluZSh4ICsgdywgeSArIHcsIHggKyB3LCB5ICsgdyAtIGIpO1xyXG4gICAgICAgIHAubGluZSh4LCB5ICsgdywgeCwgeSArIHcgLSBiKTtcclxuICAgICAgICBwLmxpbmUoeCwgeSArIHcsIHggKyBiLCB5ICsgdyk7XHJcbiAgICAgICAgcC5saW5lKHgsIHksIHggKyBiLCB5KTtcclxuICAgICAgICBpZiAodGhpcy5jZWxsLmJvcmRlcnMudG9wKSB7XHJcbiAgICAgICAgICAgIHAubGluZSh4LCB5LCB4ICsgdywgeSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNlbGwuYm9yZGVycy5yaWdodCkge1xyXG4gICAgICAgICAgICBwLmxpbmUoeCArIHcsIHksIHggKyB3LCB5ICsgdyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNlbGwuYm9yZGVycy5ib3R0b20pIHtcclxuICAgICAgICAgICAgcC5saW5lKHggKyB3LCB5ICsgdywgeCwgeSArIHcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jZWxsLmJvcmRlcnMubGVmdCkge1xyXG4gICAgICAgICAgICBwLmxpbmUoeCwgeSArIHcsIHgsIHkpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaGlnaGxpZ2h0KHA6IHA1KSB7XHJcbiAgICAgICAgcC5ub1N0cm9rZSgpO1xyXG4gICAgICAgIHAuZmlsbCgyNTUsIDI1NSwgMjU1LCAyNTUpO1xyXG4gICAgICAgIGxldCB3ID0gQ2VsbC5jZWxsV2lkdGg7XHJcbiAgICAgICAgbGV0IHggPSB0aGlzLmNlbGwuY29sICogQ2VsbC5jZWxsV2lkdGg7XHJcbiAgICAgICAgbGV0IHkgPSB0aGlzLmNlbGwucm93ICogQ2VsbC5jZWxsV2lkdGg7XHJcbiAgICAgICAgcC5lbGxpcHNlKHggKyB3IC8gMiwgeSArIHcgLyAyLCB3IC8gMiwgdyAvIDIpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogU3RhaXJWaWV3XHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgU3RhaXJWaWV3IHtcclxuICAgIHB1YmxpYyByZWFkb25seSBzdGFpcjogU3RhaXI7XHJcblxyXG4gICAgY29uc3RydWN0b3Ioc3RhaXI6IFN0YWlyKSB7XHJcbiAgICAgICAgdGhpcy5zdGFpciA9IHN0YWlyO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkcmF3KHA6IHA1KSB7XHJcbiAgICAgICAgcC5zdHJva2UoMjU1KTtcclxuICAgICAgICBpZiAodGhpcy5zdGFpci51cCkge1xyXG4gICAgICAgICAgICBwLmZpbGwoMTkyLCAxOTIsIDE5Mik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBwLmZpbGwoNzAsIDcwLCA3MCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCB3ID0gQ2VsbC5jZWxsV2lkdGggLSA2O1xyXG4gICAgICAgIGxldCB4ID0gdGhpcy5zdGFpci5jb2wgKiBDZWxsLmNlbGxXaWR0aCArIDM7XHJcbiAgICAgICAgbGV0IHkgPSB0aGlzLnN0YWlyLnJvdyAqIENlbGwuY2VsbFdpZHRoICsgMztcclxuICAgICAgICBwLnJlY3QoeCwgeSwgdywgdyk7XHJcbiAgICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHYW1lVmlld1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEdhbWVWaWV3IHtcclxuICAgIHB1YmxpYyByZWFkb25seSBnYW1lOiBNb3JpYUdhbWU7XHJcblxyXG4gICAgY29uc3RydWN0b3IoZ2FtZTogTW9yaWFHYW1lKSB7XHJcbiAgICAgICAgdGhpcy5nYW1lID0gZ2FtZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZHJhdyhwOiBwNSkge1xyXG4gICAgICAgIHAuYmFja2dyb3VuZCgwKTtcclxuICAgICAgICBsZXQgbXYgPSBuZXcgTWF6ZVZpZXcodGhpcy5nYW1lLm1hemUoKSk7XHJcbiAgICAgICAgbXYuZHJhdyhwKTtcclxuICAgICAgICBsZXQgaGVybyA9IHRoaXMuZ2FtZS5nZXRIZXJvKCk7XHJcbiAgICAgICAgbGV0IGh2ID0gbmV3IEhlcm9WaWV3KGhlcm8pO1xyXG4gICAgICAgIGh2LmRyYXcocCk7XHJcblxyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibkxldmVsXCIpLmlubmVySFRNTCA9IHRoaXMuZ2FtZS5nZXRMZXZlbCgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJsaWZlXCIpLmlubmVySFRNTCA9IGhlcm8ubGlmZS50b1N0cmluZygpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogSGVyb1ZpZXdcclxuICovXHJcbmV4cG9ydCBjbGFzcyBIZXJvVmlldyB7XHJcbiAgICBwcml2YXRlIGhlcm86IEhlcm87XHJcblxyXG4gICAgY29uc3RydWN0b3IoaGVybzogSGVybykge1xyXG4gICAgICAgIHRoaXMuaGVybyA9IGhlcm87XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRyYXcocDogcDUpIHtcclxuICAgICAgICBwLnN0cm9rZSgyNTUpO1xyXG4gICAgICAgIGlmICh0aGlzLmhlcm8ubGlmZSA+IDApIHtcclxuICAgICAgICAgICAgcC5maWxsKDAsIDI1NSwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBwLmZpbGwoODAsIDAsIDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgeCA9IHRoaXMuaGVyby54ICogQ2VsbC5jZWxsV2lkdGggKyBDZWxsLmNlbGxXaWR0aCAvIDI7XHJcbiAgICAgICAgbGV0IHkgPSB0aGlzLmhlcm8ueSAqIENlbGwuY2VsbFdpZHRoICsgQ2VsbC5jZWxsV2lkdGggLyAyO1xyXG4gICAgICAgIGxldCByID0gQ2VsbC5jZWxsV2lkdGggLyAyIC0gMTtcclxuICAgICAgICBwLmVsbGlwc2UoeCwgeSwgciwgcik7XHJcbiAgICB9XHJcbn0iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9wNS5kLnRzXCIgLz5cclxuXHJcbmltcG9ydCB7IE1vcmlhR2FtZSB9IGZyb20gXCIuL2dhbWVcIlxyXG5pbXBvcnQgeyBHYW1lVmlldyB9IGZyb20gXCIuL3ZpZXdzXCJcclxuaW1wb3J0IHsgRGlyZWN0aW9uIH0gZnJvbSBcIi4vaGVyb1wiXHJcblxyXG5cclxubGV0IGdhbWU6IE1vcmlhR2FtZTtcclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZUluZm8oKSB7XHJcbiAgICBsZXQgbGV2ZWxFbHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5MZXZlbFwiKTtcclxuICAgIGxldmVsRWx0LmlubmVySFRNTCA9IGdhbWUuZ2V0TGV2ZWwoKS50b1N0cmluZygpO1xyXG59XHJcblxyXG5sZXQgc2tldGNoID0gZnVuY3Rpb24gKHA6IGFueSkge1xyXG4gICAgcC5zZXR1cCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBnYW1lID0gbmV3IE1vcmlhR2FtZSg4LCAxMCwgNSk7XHJcbiAgICAgICAgbGV0IGNhbnZhcyA9IHAuY3JlYXRlQ2FudmFzKGdhbWUud2lkdGgsIGdhbWUuaGVpZ2h0KTtcclxuICAgICAgICBjYW52YXMucGFyZW50KCdnYW1lJyk7XHJcbiAgICAgICAgcC5mcmFtZVJhdGUoMTApO1xyXG4gICAgfTtcclxuXHJcbiAgICBwLmRyYXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcC5iYWNrZ3JvdW5kKDApO1xyXG4gICAgICAgIGxldCB2aWV3ID0gbmV3IEdhbWVWaWV3KGdhbWUpO1xyXG4gICAgICAgIHZpZXcuZHJhdyhwKTtcclxuICAgICAgICB1cGRhdGVJbmZvKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHAua2V5UHJlc3NlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoZ2FtZS5nZXRIZXJvKCkubGlmZSA8PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHAua2V5Q29kZSA9PT0gcC5VUF9BUlJPVykge1xyXG4gICAgICAgICAgICBnYW1lLm1vdmVIZXJvKERpcmVjdGlvbi5VUCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChwLmtleUNvZGUgPT09IHAuRE9XTl9BUlJPVykge1xyXG4gICAgICAgICAgICBnYW1lLm1vdmVIZXJvKERpcmVjdGlvbi5ET1dOKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHAua2V5Q29kZSA9PT0gcC5MRUZUX0FSUk9XKSB7XHJcbiAgICAgICAgICAgIGdhbWUubW92ZUhlcm8oRGlyZWN0aW9uLkxFRlQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocC5rZXlDb2RlID09PSBwLlJJR0hUX0FSUk9XKSB7XHJcbiAgICAgICAgICAgIGdhbWUubW92ZUhlcm8oRGlyZWN0aW9uLlJJR0hUKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn07XHJcblxyXG5sZXQgbXlwNSA9IG5ldyBwNShza2V0Y2gpOyJdLCJzb3VyY2VSb290IjoiIn0=